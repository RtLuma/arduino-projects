<html>

<head>
    <style type="text/css">
        fieldset {
            display: inline;
        }
        
        legend {
            text-align: center;
        }
    </style>
    <script type="text/javascript" src="colorpicker.min.js"></script>
    <style type="text/css">
        #picker {
            display: inline-block;
            width: 50%;
            height: 70%
        }
        
        #slide {
            display: inline-block;
            width: 10%;
            height: 70%;
        }
    </style>`
    <!-- <fieldset> -->
    <!-- <legend>RGB</legend> -->
    <div id="picker"></div>
    <div id="slide"></div>
    <!-- </fieldset> -->

    <script type="text/javascript">
        const API_URL = "http://192.168.0.69?";
        let cansend = true;

        async function sendPacket(data) {
            if (!cansend) return;

            let query = API_URL;
            for (const [key, value] of Object.entries(data)) query += `${key}=${value}&`;
            query = query.slice(0, -1);
            console.log(query)

            const resp = await fetch(query, {
                mode: 'no-cors',
                credentials: "include",
            })
            const body = await resp.text();
            cansend = true;
            console.log(body)
        }

        function debug(e) {
            console.log(e.value)
        }

        ColorPicker(
            document.getElementById('slide'),
            document.getElementById('picker'),
            (hex, hsv, rgb) => { document.body.style.backgroundColor = hex; sendPacket(rgb); });
        /*
                   return fetch(url, {
                   body: JSON.stringify(data), // must match 'Content-Type' header
                   cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
                   credentials: 'same-origin', // include, same-origin, *omit
                   headers: {
                   'user-agent': 'Mozilla/4.0 MDN Example',
                   'content-type': 'application/json'
                   },
                   method: 'POST', // *GET, POST, PUT, DELETE, etc.
                   mode: 'cors', // no-cors, cors, *same-origin
                   redirect: 'follow', // manual, *follow, error
                   referrer: 'no-referrer', // *client, no-referrer })
                   */
    </script>
</head>

<body>
    <br>
    <fieldset>
        <legend>Width</legend>
        <input type="range" value="0" min="2" max="50" name="w" oninput="sendPacket({[this.name]:this.value})">
    </fieldset>
    <fieldset>
        <legend>Speed</legend>
        <input type="range" value="0" min="5" max="128" name="f" oninput="sendPacket({[this.name]:this.value})">
    </fieldset>
    <fieldset>
        <legend>Population</legend>
        <input type="range" value="20" min="20" max="180" name="p" oninput="sendPacket({[this.name]:this.value})">
    </fieldset>
    <br>
    <input type="button" value="Next" name="Next" onclick='sendPacket({m:"v"})'>
</body>

</html>