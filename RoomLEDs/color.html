<html>

<head>
    <style type="text/css">
        fieldset {
            display: inline;
        }
        
        legend {
            text-align: center;
        }
    </style>
    <script>
/*
   return fetch(url, {
   body: JSON.stringify(data), // must match 'Content-Type' header
   cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
   credentials: 'same-origin', // include, same-origin, *omit
   headers: {
   'user-agent': 'Mozilla/4.0 MDN Example',
   'content-type': 'application/json'
   },
   method: 'POST', // *GET, POST, PUT, DELETE, etc.
   mode: 'cors', // no-cors, cors, *same-origin
   redirect: 'follow', // manual, *follow, error
   referrer: 'no-referrer', // *client, no-referrer })
   */

        const API_URL = "http://10.0.0.69";
        // let cansend = true;
        
        function sendpacket(args) {
            // if (cansend) return;
            let url = `${API_URL}?`;
            for (let a of Object.keys(args)) url += `${a}=${args[a]}&`;
            url=url.slice(0, -1);
            console.log(url)
            fetch(url, {
                mode: 'no-cors',
                credentials: "include"
            })
            // .then(d => {cansend = true;});
        }

        function color(bar) {
            sendpacket(JSON.parse(`{"${bar.name}":${bar.value}}`))
        };

        function next() {
            if (!cansend) return;
            cansend = false;
            fetch(`${API_URL}/next`, {
                    mode: 'no-cors'
                })
                .then(d => d.text())
                .then(d => {
                    cansend = true;
                })
        };
    </script>
</head>

<body>
    <pre></pre>
    <fieldset>
        <legend>Red</legend>
        <input type="range" value="0" min="0" max="255" name="r" oninput="color(this)" onchange="color(this)">
    </fieldset>
    <fieldset>
        <legend>Green</legend>
        <input type="range" value="0" min="0" max="255" name="g" oninput="color(this)" onchange="color(this)">
    </fieldset>
    <fieldset>
        <legend>Blue</legend>
        <input type="range" value="0" min="0" max="255" name="b" oninput="color(this)" onchange="color(this)">
    </fieldset>
    <br>
    <input type="button" value="Next" name="Next" onclick="next()">
</body>

</html>